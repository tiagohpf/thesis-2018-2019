/*! fuxi - v1.21.0 - 2016-11-28 */!function(a,b,c,d){!function(a){a.fn.eeFilterByData=function(b,c){var d=this;return d.filter("undefined"==typeof c?function(){return"undefined"!=typeof a(this).data(b)}:function(){return a(this).data(b).toLowerCase().indexOf(c.toLowerCase())>=0})}}(b.jQuery);var e={init:function(b,c){var d=this;d.elem=c,d.$elem=a(c),d.tree=null,d.options=a.extend(!0,{},a.fn.eEditor.options,b),d.$eaRule=a(".fx-ee-editable-area",d.$elem),d.$btnConfirm=a(".fx-ee-confirm",d.$elem),d.$btnCancel=a(".fx-ee-cancel",d.$elem),d.$feedback=a(".fx-ee-feedback",d.$elem),d.$feedbackMsg=a(".fx-validation-feedback-messsage",d.$elem),d.$feedbackIcon=a(".fx-validation-feedback-icon",d.$elem),d.$ruleEditor=a(".fx-ee-form-group-type-rule",d.$elem),d.$eeContainer=a(".fx-ee-wrapper",d.$elem),d.$eeBody=a(".fx-ee-body",d.$elem),d.$btnCheckSintax=a(".fx-check-syntax",d.$elem),d.$btnClearRule=a(".fx-clear-rule",d.$elem),d.$btsActions=null,d.btsActionsSelector=".fx-ee-btn-action",d.$moreActionsContainer=a(".fx-ee-more-actions-wrapper",d.$elem),d.$btsAllActions=a(".fx-ee-toogle-all-actions",d.$elem),d.$allActionsWrapper=a(".fx-ee-all-actions-wrapper",d.$elem),d.$allActionsContainer=a(".fx-ee-all-actions",d.$elem),d.$commonActionsContainer=a(".fx-ee-common-actions",d.$elem),d.$txtSearchExpression=a(".fx-ee-search-expression-value",d.$elem),d.$btnSearchExpression=a(".fx-ee-search-expression",d.$elem),d.$txtSearchAction=a(".fx-ee-search-action-value",d.$elem),d.$btnSearchAction=a(".fx-ee-search-action",d.$elem),d.$returnType=a(".fx-ee-return-type",d.$elem),d.$eeOptionsContainer=a(".fx-ee-options",d.$elem),d.$treeContainer=a(".fx-ee-tree-container",d.$elem),d.nodePopInfoSelector="i.fx-jstree-popoverinfo",d.nodeDraggableSelector="li[data-drag] a",d.nodeRuleSelector="li[data-expression]",d.layout=d.$eeContainer.layout(d.options.layoutOptions),d.load(),d.addListeners()},addListeners:function(){var b=this;b.$btnConfirm.off("click.ee").on("click.ee",a.proxy(b.emitConfirmClick,b)),b.$btnCancel.off("click.ee").on("click.ee",a.proxy(b.emitCancelClick,b)),b.$btnSearchExpression.off("click.ee").on("click.ee",a.proxy(b.emitSearchExpressionClick,b)),b.$btnSearchAction.off("click.ee").on("click.ee",a.proxy(b.emitSearchActionClick,b)),b.$btsActions.off("click.ee").on("click.ee",a.proxy(b.operatorClick,null,b)),b.$btsAllActions.off("click.ee").on("click.ee",a.proxy(b.toggleAllActions,null,b)),b.$eaRule[0].addEventListener&&b.$eaRule[0].addEventListener("drop",function(a){a.preventDefault()},!1),b.$btnCheckSintax.off("click.ee").on("click.ee",a.proxy(b.checkSyntax,null,b)),b.$btnClearRule.off("click.ee").on("click.ee",a.proxy(b.clearRule,b)),b.$txtSearchAction.off("keypress.ee").on("keypress.ee",a.proxy(b.handlerSearchAction,null,b)),b.$txtSearchExpression.off("keypress.ee").on("keypress.ee",a.proxy(b.handlerSearchExpression,null,b))},load:function(){var b=this;b.$feedback.hide(),b.$txtSearchExpression.val(""),b.$txtSearchAction.val(""),b.loadActionsGroup.call(b),b.$btsActions=a(b.btsActionsSelector,b.$elem),b.options.hideEastPanel&&b.layout.hide("east"),b.options.hideWestPanel&&b.layout.hide("west"),b.$elem.hasClass("modal")&&b.$eaRule.focus(),b.layout.resizeAll(),b.$treeContainer.on("ready.jstree",function(){b.setNodePopover(b),b.setNodeDraggable(b),b.setNodeDblClick(b)}).jstree({core:{animation:0,check_callback:!0,themes:{name:"fuxi",responsive:!1,stripes:!1,dots:!0,icons:!0},data:b.options.expressionItems},popoverinfo:{popinfoID:"popinfo",className:"fx-ee-tree-more-info glyphicon glyphicon-info-sign",click:function(c,d){var e=a("#"+d);e.next(".popover-node-info").remove(),e.after(b.formatInfoTemplate(c.original)),e.popover("toggle")}},plugins:["popoverinfo","search","fxsearchmatch"],search:{case_insensitive:!0,show_only_matches:!1}}).bind("open_node.jstree",function(){b.setNodePopover(b),b.setNodeDraggable(b),b.setNodeDblClick(b)}).bind("hover_node.jstree",function(b,c){c.node.original.info&&a(this).trigger(FUXI.Utils.eventsName.hideElements)}),b.emitLoaded()},destroy:function(){var b=this;b.$btnConfirm.off("click.ee"),b.$btnCancel.off("click.ee"),b.$btnSearchExpression.off("click.ee"),b.$btnSearchAction.off("click.ee"),b.$btsActions.off("click.ee"),b.$btsAllActions.off("click.ee"),b.$txtSearchAction.off("keypress.ee"),b.$txtSearchExpression.off("keypress.ee"),b.$eaRule[0].removeEventListener&&b.$eaRule[0].removeEventListener("drop",function(a){a.preventDefault()},!1),b.$btnCheckSintax.off("click.ee"),b.$btnClearRule.off("click.ee"),b.$treeContainer.jstree("destroy"),a(b.nodeRuleSelector,b.$elem).off("dblclick.ee"),a(b.nodeDraggableSelector,b.$elem).draggable().draggable("destroy"),a(b.nodeDraggableSelector,b.$elem).droppable().droppable("destroy"),a(b.nodePopInfoSelector,b.$elem).popover("destroy"),a(b.nodeRuleSelector,b.$elem).off("dblclick.ee"),b.$commonActionsContainer.html(b.options.languageStrings.noActins),b.$allActionsContainer.html(b.options.languageStrings.noActins),b.clearRule(),b.$elem.removeData("ee")},setNodePopover:function(b){var c=this;a(b.nodePopInfoSelector,c.$elem).popover({html:!0,container:c.$eeBody,placement:"right",trigger:"manual",template:'<div class="popover"><div class="arrow"></div><div class="popover-content"></div></div>',content:function(){return this.cache?this.cache:this.cache=a(this).next(".popover-node-info").html()}})},setNodeDblClick:function(b){var c=this;a(b.nodeRuleSelector,c.$elem).off("dblclick.ee").on("dblclick.ee",a.proxy(b.nodeDoubleClick,null,b))},setNodeDraggable:function(b){var c=this;a(b.nodeDraggableSelector,c.$elem).draggable({cursor:"move",helper:"clone",containment:c.$eeBody,appendTo:c.$eeBody}),b.$eaRule.droppable({accept:a(b.nodeDraggableSelector,c.$elem),drop:function(c,d){var e=a(d.draggable).closest("li").attr("data-expression");b.addExpression(e)}})},handlerSearchAction:function(a,b){13===b.keyCode&&(b.preventDefault(),b.stopImmediatePropagation(),a.$btnSearchAction.trigger("click.ee"))},handlerSearchExpression:function(a,b){13===b.keyCode&&(b.preventDefault(),b.stopImmediatePropagation(),a.$btnSearchExpression.trigger("click.ee"))},operatorClick:function(b){var c=a(this).data("action");b.addExpression(c),b.emitOperatorClick(c)},toggleAllActions:function(a,b){a.$allActionsWrapper.toggleClass("hidden"),a.$commonActionsContainer.toggleClass("opened"),a.layout.resizeAll(),a.$allActionsWrapper.hasClass("hidden")?a.$eaRule.focus():a.$txtSearchAction.focus(),b.stopPropagation()},nodeDoubleClick:function(b){var c=a(this);b.addExpression(c.attr("data-expression")),arguments[1].originalEvent.preventDefault(),arguments[1].originalEvent.stopPropagation()},checkSyntax:function(a){var b=3e3,c="fx-validation-feedback-icon fuxicons fuxicons-error",d="fx-validation-feedback-icon fuxicons fuxicons-warning",e="fx-validation-feedback-icon fuxicons fuxicons-success";if(a.$eaRule.focus(),a.$feedback.stop(!0,!0),""==a.$eaRule.val())a.$feedbackIcon.removeClass().addClass(d),a.$feedback.removeClass("alert-danger alert-success").addClass("alert-warning").fadeIn(),a.$feedbackMsg.html(a.options.languageStrings.feedbackEmptyRule),a.$ruleEditor.removeClass("hidden has-error has-success").addClass("has-warning");else{var f=a.checkRuleSyntax();f?(a.$feedbackIcon.removeClass().addClass(e),a.$feedback.removeClass("alert-danger alert-warning").addClass("alert-success").fadeIn(),a.$feedbackMsg.html(a.options.languageStrings.feedbackSucceed),a.$ruleEditor.removeClass("hidden has-error has-warning").addClass("has-success")):(a.$feedbackIcon.removeClass().addClass(c),a.$feedback.removeClass("alert-success alert-warning").addClass("alert-danger").fadeIn(),a.$feedbackMsg.html(a.options.languageStrings.feedbackError),a.$ruleEditor.removeClass("hidden has-success").addClass("has-error"),b=5e3)}setTimeout(function(){a.$feedback.fadeOut(b,a.layout.resizeAll),a.$ruleEditor.removeClass("has-error has-success has-warning")},b),a.layout.resizeAll(),a.emitCheckSyntax(a.$eaRule.val())},clearRule:function(){var a=this;a.$eaRule.val("").focus(),a.emitClearRule()},addExpression:function(a){var b=this;b.insertAtCaret(a),b.emitAddExpression(a)},emitSearchExpressionClick:function(){var a=this,b=a.$txtSearchExpression.val();a.$treeContainer.jstree(!0).search(b),a.$elem.trigger({type:"searchexpressionclick.ee",search:b,ee:a})},emitSearchActionClick:function(){var a=this,b=a.$txtSearchAction.val();a.$allActionsContainer.find(".fx-ee-btn-action").eeFilterByData("action",b).addClass("fx-ee-action-highlight").removeClass("fx-ee-action-highlight",5e3),a.$elem.trigger({type:"searchactionclick.ee",search:b,ee:a})},emitConfirmClick:function(){var a=this,b=a.$eaRule.val();a.$elem.trigger({type:"confirmclick.ee",rule:b,returntype:a.$returnType.val(),ee:a})},emitCancelClick:function(){var a=this;a.$elem.trigger({type:"cancelclick.ee",ee:a})},emitOperatorClick:function(a){var b=this;b.$elem.trigger({type:"operatorclick.ee",action:a,ee:b})},emitCheckSyntax:function(a){var b=this;b.$elem.trigger({type:"checksyntax.ee",rule:a,ee:b})},emitClearRule:function(){var a=this;a.$elem.trigger({type:"clearrule.ee",ee:a})},emitAddExpression:function(a){var b=this;b.$elem.trigger({type:"addexpression.ee",expression:a,ee:b})},emitLoaded:function(){var a=this;a.$elem.trigger({type:"loaded.ee",ee:a})},insertAtCaret:function(a){var b=this;if(a){var d=b.$eaRule[0];if(d.focus(),c.selection)selection=c.selection.createRange(),selection.text=a,d.focus();else if(d.selectionStart||"0"==d.selectionStart){var e=d.selectionStart,f=d.selectionEnd,g=d.scrollTop;d.value=d.value.substring(0,e)+a+d.value.substring(f,d.value.length),d.selectionStart=e+a.length,d.selectionEnd=e+a.length,d.scrollTop=g}else d.value+=a,d.focus();b.$eaRule.trigger("change")}},formatInfoTemplate:function(a){var b="<div class='popover-node-info hide'>"+FUXI.Resources.Common.EmptyInfo+"</div>";if(a&&a.info){var c=a.info;b="<div class='popover-node-info hide'>"+c+"</div>"}return b},loadActionsGroup:function(){var b,c,d,e=this,f={},g=[],h=[],i=e.options.templateGroup,j=e.options.templateGroupItem,k=e.options.templateAllActions,l="";a.each(e.options.operatorItems,function(e,m){f[m.name]||(f[m.name]=[]),b=i.replace(new RegExp("{{NAME}}","ig"),m.name).replace(new RegExp("{{CSSNAME}}","ig"),m.cssname),c=k.replace(new RegExp("{{NAME}}","ig"),m.name).replace(new RegExp("{{CSSNAME}}","ig"),m.cssname),d="",l="",a.each(m.items,function(a,b){f[m.name].push(b.action),a<m.maxitems&&(d+=j.replace(new RegExp("{{ACTION}}","ig"),b.action).replace(new RegExp("{{TEXT}}","ig"),b.text).replace(new RegExp("{{WEIGHT}}","ig"),b.weight)),l+=j.replace(new RegExp("{{ACTION}}","ig"),b.action).replace(new RegExp("{{TEXT}}","ig"),b.text).replace(new RegExp("{{WEIGHT}}","ig"),b.weight)}),b=b.replace(new RegExp("{{ITEMS}}","ig"),d);var n=a("<div />").html(b);g.push(n.html()),c=c.replace(new RegExp("{{ITEMS}}","ig"),l),n=a("<div />").html(c),h.push(n.html())}),e.$commonActionsContainer.html(g.length>0?g.join(""):e.options.languageStrings.noActins),e.$allActionsContainer.html(h.length>0?h.join(""):e.options.languageStrings.noActins)},getCheckRuleSyntaxClientValidator:function(){var a=this;return a.options.clientCheckRuleSyntaxValidator},checkRuleSyntax:function(){var a=this,c=!0;try{var d=a.getCheckRuleSyntaxClientValidator();"string"==typeof d?d&&(c=FUXI.Utils.executeFunctionByName(d,b,a.$eaRule.val())):"function"==typeof d&&(c=d(a.$eaRule.val()))}catch(e){}return c}};a.fn.eEditor=function(b){return this.each(function(){var c=Object.create(e);c.init(b,this),a.data(this,"ee",c)}).data("ee")},a.fn.eEditor.options={layoutOptions:{defaults:{resizable:!0,livePaneResizing:!0,resizerTip:"Resize",spacing_closed:10,spacing_open:10},west:{size:250,contentSelector:".fx-ee-options"},center:{size:450,minSize:100,maxSize:450,contentSelector:".fx-ee-constructors"},east:{size:100,contentSelector:".fx-ee-options"}},hideWestPanel:!1,hideEastPanel:!0,clientCheckRuleSyntaxValidator:d,expressionItems:[],operatorItems:[],templateGroup:'<div class="fx-ee-actions-group {{CSSNAME}}" data-name="{{NAME}}">{{ITEMS}}</div>',templateGroupItem:'<button type="button" class="btn btn-default btn-xs fx-ee-btn-action" data-action="{{ACTION}}">{{TEXT}}</button>',templateAllActions:'<div class="col-sm-6 fx-ee-all-actions-block {{CSSNAME}}" data-name="{{NAME}}"><p class="fx-ee-all-actions-block-title">{{NAME}}</p><div>{{ITEMS}}</div></div>',languageStrings:{feedbackSucceed:"A regra definida não apresenta nenhum problema.",feedbackError:"A regra definida não está corretamente formatada.",feedbackEmptyRule:"Não foi definida nenhuma regra. Por favor escreva a regra pretendida.",noActins:"<p>Não foi definido nenhum operador.</p>"}}}(jQuery,window,document);