/*! fuxi - v1.21.0 - 2016-11-28 */!function(a,b,c,d){function e(a,b,c,d){var e=_.union(a,b);return e=_.uniq(e,d)}function f(a,b){return _.forEach(b,function(b){a=_.reject(a,{id:b.id})}),a}var g={init:function(b,c){var d=this;d.elem=c,d.$elem=a(c),d.filterItems=null,d.selectBoxDropActive=!1,d.options=a.extend(!0,{},a.fn.selectBoxTree.options,b),d.originalSelectedItems=d.options.selectedItems,d.$selectionContainer=a(".fx-ms-selection-container",d.$elem),d.$selectionChoices=a(".fx-ms-choices",d.$selectionContainer),d.$expandArrow=a(".fx-ms-expand-arrow",d.$selectionContainer),d.$dropdownContainer=a(".fx-ms-dropdown",d.$elem),d.$searchContainer=a(".fx-ms-search-container",d.$dropdownContainer),d.$selectAllContainer=a(".fx-ms-select-all-container",d.$dropdownContainer),d.$dropdownTree=a(".fx-ms-dropdown-tree",d.$dropdownContainer),d.$dropdownGrid=a(".fx-ms-dropdown-grid",d.$dropdownContainer),d.$searchField=a(".fx-ms-search",d.$dropdownContainer),d.selectAllSelector=".fx-ms-select-all",d.deleteChoiceSelector=".fx-ms-search-choice-close",d.itemMultiSelectSelector="li input:checkbox[data-multi-select]",d.itemUniSelectSelector="li a[data-uni-select]",d.inputValues=a(".fx-ms-input-values",d.$elem).eq(0),d.initMarkup(),d.addListeners(),d.options.disabled?d.setDisable():"grid"===d.options.showMode?(d.loadGrid(),d.$dropdownTree.addClass("hidden"),d.$dropdownGrid.removeClass("hidden")):(d.$dropdownTree.removeClass("hidden"),d.loadTree(),d.$dropdownGrid.addClass("hidden")),d.fillInputValue(),d.winResize(),d.scrollHandler()},appendDropdownTo:function(a){var b=this;b.$dropdownContainer.appendTo(a)},elementPosition:function(c){var d=this,e=d.$dropdownContainer,f=d.$elem,g=a(b),h=e.hasClass("fx-ms-dropdown-above"),i=null,j=(f.position(),f.offset()),k={height:f.outerHeight(!1),width:f.outerWidth(!1),top:j.top};k.bottom=j.bottom=j.top+k.height;var l=parseInt(f.css("border-bottom-width"))||0,m={height:e.outerHeight(!1)},n=({top:g.scrollTop(),bottom:g.scrollTop()+g.height()},k.height),o=j.top+n,p=m.height,q=g.height(),r=g.scrollTop()+q,s=r>=o+p,t=j.top-p>=g.scrollTop(),u={left:j.left,top:k.bottom-l,width:k.width};h?!t&&s&&(i="below"):!s&&t&&(i="above"),t||s||(i="below"),("above"==i||h&&"below"!==i)&&(u.top=k.top-m.height),null!=i&&(e.removeClass("fx-ms-dropdown-below fx-ms-dropdown-above").addClass("fx-ms-dropdown-"+i),f.removeClass("fx-ms-container-below fx-ms-container-above").addClass("fx-ms-container-"+i)),e.css(u),c||setTimeout(function(){d.elementPosition(!0)},50)},winResize:function(){var c,d=this;a(b).on("resize",function(){clearTimeout(c),c=setTimeout(function(){d.selectBoxDropActive&&d.elementPosition()},100)})},scrollHandler:function(){var c,d=this;d.$elem.closest(".modal").scroll(function(){clearTimeout(c),c=setTimeout(function(){d.selectBoxDropActive&&d.elementPosition()},100)}),a(b).on("DOMMouseScroll mousewheel",function(b){a(b.target).closest(".fx-ms-dropdown").length>0||d.closeDropdown()})},destroy:function(){var a=this;a.closeDropdown(),a.$expandArrow.removeClass("hidden"),a.$selectionContainer.removeClass("fx-ms-selection-container-multi").addClass("fx-ms-selection-container"),a.$selectionChoices.empty(),a.$dropdownTree.removeClass("hidden"),a.$dropdownTree.jstree("destroy"),a.$dropdownTree.empty(),a.$dropdownGrid.addClass("hidden"),a.$dropdownGrid.find("ul").empty(),a.$selectAllContainer.find(a.selectAllSelector).prop("checked",!1),a.inputValues.val(""),a.$elem.removeData("ms")},addListeners:function(){var b=this;b.removeListeners(),b.$selectionContainer.on("click.ms.dropdown",a.proxy(b.triggerDropdown,b)),b.$selectionChoices.on("click.ms.deletechoice",b.deleteChoiceSelector,a.proxy(b.unselectItemChoice,b)),b.$searchField.on("keyup.ms.search",a.proxy(b.handleSearch,b)),b.$selectAllContainer.find(b.selectAllSelector).on("click.ms.selectall",a.proxy(b.handleSelectAll,b))},removeListeners:function(){var b=this;b.$selectionContainer.off("click.ms.dropdown"),b.$selectionChoices.off("click.ms.deletechoice"),b.$searchField.off("keyup.ms.search"),b.$selectAllContainer.off("click.ms.selectall"),"grid"===b.options.showMode&&b.$elem.off("click.ms.inputclick"),a(c).off("click.ms.outer")},initMarkup:function(){var b=this;b.$elem.addClass("fx-ms-focusser");var c=b.$elem.prop("id"),d=a('<input class="sr-only" id="focusser-'+c+'" />');if(b.$elem.append(d),a("label[for='"+c+"']").prop("for","focusser-"+c),d.on("focus",function(){b.$elem.addClass("fx-ms-has-focus")}).on("blur",function(){b.$elem.removeClass("fx-ms-has-focus")}).on("keydown",function(a){if(13==a.which){if(a.altKey||a.ctrlKey||a.shiftKey||a.metaKey)return;b.triggerDropdown(),a.stopPropagation()}}),"grid"===b.options.showMode){var e=a("<dummy></dummy>").append(a.trim(b.options.gridItemTemplate));b.options.multiple?e.find("label[data-uni-select]").remove():e.find("label[data-multi-select]").remove(),b.options.gridItemTemplate=e.html()}b.options.multiple?b.$selectionContainer.removeClass("fx-ms-selection-container").addClass("fx-ms-selection-container-multi"):b.$selectionContainer.addClass("fx-ms-selection-container").removeClass("fx-ms-selection-container-multi"),b.options.fullWidth?b.$elem.addClass("full-width"):b.$elem.removeClass("full-width"),b.options.showSearch?b.$searchContainer.removeClass("hidden"):b.$searchContainer.addClass("hidden"),b.options.showSelectAll&&b.options.multiple?b.$selectAllContainer.removeClass("hidden"):b.$selectAllContainer.addClass("hidden"),b.$searchField.attr("placeholder",b.options.searchPlaceholder),b.setSelectedPlaceholder()},loadTree:function(){var b=this,c=b.getJSTreeConfiguration(),d=b.$dropdownTree.jstree(c);d.on("click.jstree",function(a){a.stopImmediatePropagation()}).on("changed.jstree",function(a,c){"select_node"===c.action?b.selectItemTree(c.event,c):"deselect_node"===c.action&&b.unselectItemTree(c.event,c)}).on("loaded.jstree",function(){b.selectSelectedItems(),b.renderSelectedItems(!0)}).on("search.jstree",function(){b.filterItems=[],a("li.jstree-node:visible",b.$dropdownTree).each(function(){var a=_.find(b.options.items,{id:this.id});a&&b.filterItems.push(a)})}).on("clear_search.jstree",function(){b.filterItems=null,b.updateSelectAll()}).on("after_open.jstree",function(){b.elementPosition()}).on("after_close.jstree",function(){b.elementPosition()})},loadGrid:function(){var b=this,c=b.$dropdownGrid.find("ul"),d=[],e=b.filterItems||b.options.items;a.each(e,function(a,c){d.push(b.options.gridItemTemplate.replace(/{{ID}}/gi,c.id).replace(/{{TEXT}}/gi,c.text))}),c.html(d.join("")),b.options.multiple?c.find(b.itemMultiSelectSelector).off("click.ms.inputclick").on("click.ms.inputclick",a.proxy(b.handleItemGridClick,b)):c.find(b.itemUniSelectSelector).on("click.ms.inputclick",a.proxy(b.handleItemGridClick,b)),b.selectSelectedItems(),b.renderSelectedItems(!0)},openDropdown:function(){var b=this;b.selectBoxDropActive=!0,b.appendDropdownTo("body"),b.elementPosition(),b.$dropdownContainer.removeClass("hidden"),b.$selectionContainer.addClass("fx-ms-container-active"),b.$expandArrow.addClass("fx-ms-expanded-arrow"),b.$elem.addClass("fx-ms-wrapper-opened"),b.$searchField.focus(),a(c).on("mousedown.ms.outside",a.proxy(b.outsideClick,b)),b.$elem.closest(".fx-overflow").on("wheel",function(){return!1})},closeDropdown:function(){var b=this;b.selectBoxDropActive=!1,b.appendDropdownTo(b.$elem),b.$dropdownContainer.addClass("hidden"),b.$selectionContainer.removeClass("fx-ms-container-active"),b.$expandArrow.removeClass("fx-ms-expanded-arrow"),b.$elem.removeClass("fx-ms-wrapper-opened"),a(c).off("mousedown.ms.outside"),b.$elem.closest(".fx-overflow").off("wheel")},triggerDropdown:function(){var a=this;return a.selectBoxDropActive?void a.closeDropdown():a.openDropdown()},outsideClick:function(b){var c=this;if(c.selectBoxDropActive){var d=a.contains(c.$dropdownContainer.get(0),b.target),e=a.contains(c.elem,b.target);d||e||c.closeDropdown()}},emitSelectAll:function(){var a=this;a.$elem.trigger({type:"selectall.fx.selectboxtree",ms:a})},emitUnselectAll:function(){var a=this;a.$elem.trigger({type:"unselectall.fx.selectboxtree",ms:a})},handleSelectAll:function(b){var c=this;if(c.options.multiple){var d=a(b.currentTarget);d.is(":checked")?("grid"===c.options.showMode?c.selectAllGrid():c.selectAllTree(),c.emitSelectAll()):(c.clearAll(),c.emitUnselectAll())}},emitDeselectedItem:function(){var a=this;a.$elem.trigger({type:"deselecteditem.fx.selectboxtree",ms:a})},unselectItemTree:function(b,c){if(c.event){var d=this,e=c.node.original;e[d.options.selectableName]&&c.changed?a.each(c.changed.deselected,function(a,b){e=c.instance.get_node(b).original,e[d.options.selectableName]||d.unselectItem(e)}):c.changed?a.each(c.changed.deselected,function(a,b){e=c.instance.get_node(b).original,e[d.options.selectableName]||d.unselectItem(e)}):e[d.options.selectableName]||d.unselectItem(e)}},unselectItemChoice:function(b){b.stopPropagation();var c=this,d=a(b.currentTarget).data("item-id");if(""===e)return void c.clearAll();var e=c.getItemById(d);if("grid"===c.options.showMode){var f=c.options.multiple?c.itemMultiSelectSelector+"[value="+e.id+"]":c.itemUniSelectSelector+"[value="+e.id+"]";c.$dropdownGrid.find(f).prop("checked",!1).closest(".fx-ms-grid-element").removeClass("fx-ms-grid-element-selected")}else c.$dropdownTree.jstree(!0).deselect_node(e.id,!1);c.unselectItem(e)},unselectItem:function(a){var b=this;b.removeSelectedItem(a),b.renderSelectedItems(!0),b.emitDeselectedItem()},unselectAllTree:function(){var a=this;a.$dropdownTree.jstree("uncheck_all"),a.options.selectedItems=[],a.renderSelectedItems(!0)},selectAllTree:function(){var b=this,c=e(b.options.selectedItems,b.filterItems||b.options.items,!0,"id");c=a.grep(c,function(a){return!a[b.options.selectableName]}),b.$dropdownTree.jstree(!0).check_node(c),b.options.selectedItems=c,b.renderSelectedItems()},selectItemTree:function(b,c){if(c.event){var d=this,e=c.node.original;e[d.options.selectableName]&&c.changed?a.each(c.changed.selected,function(a,b){e=c.instance.get_node(b).original,e[d.options.selectableName]||d.selectItem(e)}):c.changed?a.each(c.changed.selected,function(a,b){e=c.instance.get_node(b).original,e[d.options.selectableName]||d.selectItem(e)}):e[d.options.selectableName]||d.selectItem(e)}},emitSelectedItem:function(a){var b=this;b.$elem.trigger({type:"selecteditem.fx.selectboxtree",item:a,ms:b})},selectItem:function(a){var b=this;b.pushSelectedItem(a),b.renderSelectedItems(),b.emitSelectedItem(a)},unselectAllGrid:function(){var b=this;a(b.itemMultiSelectSelector).prop("checked",!1),b.options.selectedItems=f(b.options.selectedItems,b.filterItems||b.options.items),b.renderSelectedItems(!0)},selectAllGrid:function(){var b=this;a(b.itemMultiSelectSelector).prop("checked",!0),a(b.itemMultiSelectSelector,b.$dropdownContainer).closest(".fx-ms-grid-element").addClass("fx-ms-grid-element-selected");var c=e(b.options.selectedItems,b.filterItems||b.options.items,!0,"id");b.options.selectedItems=c,b.renderSelectedItems()},selectItemGrid:function(a){var b=this;b.selectItem(a)},unselectItemGrid:function(a){var b=this;b.unselectItem(a)},handleItemGridClick:function(b){b.stopPropagation();var c=this,d=a(b.currentTarget),e=c.getItemById(d.attr("value"));c.options.multiple?d.is(":checked")?(d.closest(".fx-ms-grid-element").addClass("fx-ms-grid-element-selected"),c.selectItemGrid(e)):(d.closest(".fx-ms-grid-element").removeClass("fx-ms-grid-element-selected"),c.unselectItemGrid(e)):(a(".fx-ms-grid-element",c.$dropdownContainer).removeClass("fx-ms-grid-element-selected"),d.closest(".fx-ms-grid-element").addClass("fx-ms-grid-element-selected"),c.selectItemGrid(e))},pushSelectedItem:function(a){var b=this;if(b.options.multiple){var c=_.findIndex(b.options.selectedItems,{id:a.id});-1===c&&b.options.selectedItems.push(a)}else b.options.selectedItems=[],b.options.selectedItems.push(a)},removeSelectedItem:function(a){var b=this;_.remove(b.options.selectedItems,function(b){return b.id.toString()===a.id.toString()})},renderSelectedItems:function(a){var b=this;b.sortSelectedItems(),b.renderSelectedItemMarkup(),a&&b.setSelectedPlaceholder(),b.updateSelectAll(),b.elementPosition(),b.validate(),b.fillInputValue()},renderSelectedItemMarkup:function(){var b=this;if(b.$selectionChoices.empty(),b.options.numberDisplayed>0&&b.options.selectedItems.length>b.options.numberDisplayed){var c=b.options.selectItemTemplate.replace(/{{ID}}/gi,"").replace(/{{TEXT}}/gi,b.options.selectedItems.length+" "+b.options.nSelectedText);return void b.$selectionChoices.html(c)}var d=[];a.each(b.options.selectedItems,function(a,c){d.push(b.options.selectItemTemplate.replace(/{{ID}}/gi,c.id).replace(/{{TEXT}}/gi,c.text))}),b.$selectionChoices.html(d.join(""))},selectSelectedItems:function(){var b=this;a.each(b.options.selectedItems,function(a,c){if("grid"===b.options.showMode){var d=b.options.multiple?b.itemMultiSelectSelector+"[value="+c.id+"]":b.itemUniSelectSelector+"[value="+c.id+"]";b.$dropdownGrid.find(d).prop("checked",!0).closest(".fx-ms-grid-element").addClass("fx-ms-grid-element-selected")}else b.$dropdownTree.jstree(!0).select_node(c.id)})},sortSelectedItems:function(){var a=this;a.options.selectedItems=_.sortBy(a.options.selectedItems,function(a){var b=a.text;return"string"!=typeof b?b:b.toLowerCase()})},updateSelectAll:function(){var b=this;if(b.options.showSelectAll){var c=allBoxesLength=0;if("grid"===b.options.showMode){var d=a(b.itemMultiSelectSelector);allBoxesLength=d.length,c=d.filter(":checked").length}else c=b.$dropdownTree.jstree("get_checked",!1).length,allBoxesLength=b.options.items?b.options.items.length:0,b.filterItems&&(allBoxesLength=a("li.jstree-node:visible",b.$dropdownTree).length);var e=c>0&&c===allBoxesLength;if(b.$selectAllContainer.find(b.selectAllSelector).prop("checked",e),e&&b.options.numberDisplayed>0&&b.options.selectedItems.length>b.options.numberDisplayed){b.$selectionChoices.empty();var f=b.options.selectItemTemplate.replace(/{{ITEM}}/gi,"").replace(/{{TEXT}}/gi,b.options.allSelectedText);return void b.$selectionChoices.html(f)}}},handleSearch:function(){var a=this;clearTimeout(a.hsTimeout),a.hsTimeout=setTimeout(function(){var b=a.$searchField.val();"grid"===a.options.showMode?a.searchGrid(b):a.searchTree(b),a.elementPosition()},250)},searchTree:function(a){var b=this;b.$dropdownTree.jstree(!0).search(a)},searchGrid:function(a){var b=this;return a==d||""==a?(b.filterItems=null,void b.loadGrid()):(b.filterItems=_.filter(b.options.items,function(b){var c=!1;return _.forOwn(b,function(b){return c=FUXI.Utils.like(b,a),c?!1:void 0}),c}),void b.loadGrid())},setSelectedPlaceholder:function(){var a=this;a.options.selectedItems&&0!==a.options.selectedItems.length||a.$selectionChoices.append("<li class='fx-ms-choice-placeholder'>"+a.options.selectedPlaceholder+"</li>")},setDisable:function(){var a=this;a.renderSelectedItems(!0),a.$elem.addClass("fx-ms-wrapper-disabled"),a.$selectionChoices.find(a.deleteChoiceSelector).remove(),a.removeListeners()},getJSTreeConfiguration:function(){var a=this,b=a.options.items,c=a.options.jstreePlugins,d=a.options.jstreePluginsConfiguration,e=a.options.jstreeCoreConfiguration,f={core:{data:b},plugins:[]};return c&&(f.plugins=f.plugins.concat(c),a.options.multiple||_.remove(f.plugins,function(a){return"checkbox"===a.toString().toLowerCase()})),0===f.plugins.length&&delete f.plugins,d&&d.forEach(function(b){a.options.multiple?f[b.key]=b.value:"checkbox"!==b.key.toLowerCase()&&(f[b.key]=b.value)}),e&&e.forEach(function(a){f.core[a.key]=a.value}),f},getSelectedValues:function(){var a=this;return a.options.selectedItems},getSelectedIDs:function(){var b=this,c=b.options.selectedItems,d=[];return a.each(c,function(a,b){d.push(b.id)}),d.join(b.options.selectedIDsSpacer||",")},getItemById:function(b){var c=this,d=null;if("grid"===c.options.showMode){if(c.options.items){var e=a.grep(c.options.items,function(a){return a.id.toString()===b.toString()});e.length>0&&(d=e[0])}}else{var f=c.$dropdownTree.jstree(!0);if(f){var g=f.get_node(b);d=g.original}}return d},fillInputValue:function(){var a=this;a.inputValues.val(a.getSelectedIDs())},validate:function(){var a=this;if(a.options.required){var b=a.options.selectedItems.length||0;0===b?(a.$elem.addClass("fx-ms-has-error"),a.$dropdownContainer.addClass("fx-ms-has-error")):(a.$elem.removeClass("fx-ms-has-error"),a.$dropdownContainer.removeClass("fx-ms-has-error"))}},resetSelectedItems:function(){var a=this;a.clearAll(),a.options.selectedItems=a.originalSelectedItems,a.selectSelectedItems(),a.renderSelectedItems(!0)},clearAll:function(){var a=this;"grid"===a.options.showMode?a.unselectAllGrid():a.unselectAllTree(),a.$searchField.val(""),a.handleSearch(),a.validate(),a.fillInputValue()}};a.fn.selectBoxTree=function(b){return this.each(function(){var c=Object.create(g);c.init(b,this),a.data(this,"ms",c)}).data("ms")},a.fn.selectBoxTree.options={multiple:!0,disabled:!1,showMode:"tree",showSelectAll:!1,showSearch:!0,numberDisplayed:0,allSelectedText:"",nSelectedText:"",required:!1,jstreePlugins:["checkbox","search","changed"],jstreePluginsConfiguration:[{key:"search",value:{show_only_matches:!0}},{key:"checkbox",value:{three_state:!1}}],jstreeCoreConfiguration:[{key:"themes",value:{name:"fuxi",icons:!1}}],fullWidth:!0,searchPlaceholder:"pesquisar...",selectedPlaceholder:"selecione...",items:[],selectedItems:[],selectableName:"isgroup",selectedIDsSpacer:",",selectItemTemplate:'<li class="fx-ms-search-choice"><a class="fx-ms-search-choice-close" data-item-id=\'{{ID}}\'><i class="glyphicon glyphicon-remove"></i></a><span>{{TEXT}}</span></li>',gridItemTemplate:'<li class="fx-ms-grid-element checkbox"><label data-multi-select><input type="checkbox" data-multi-select id="opt-item-{{ID}}" name="chk-item-selected" value="{{ID}}" >{{TEXT}}</label><label data-uni-select><a data-uni-select id="opt-item-{{ID}}" value="{{ID}}" title="{{TEXT}}">{{TEXT}}</a></label></li>'}}(jQuery,window,document);