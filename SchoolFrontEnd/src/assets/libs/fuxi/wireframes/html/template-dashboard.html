<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=Edge; text/html;" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0,  user-scalable=yes" />
		<link rel="icon" href="/fuxi/common/html/css/images/favicon.ico" type="image/x-icon" />
		<title>Template dashboard</title>
		<link href="/basepack/bootstrap-pt/3.0/css/bootstrap.min.css" rel="stylesheet">
		<link href="/basepack/datatables-pt/1.9/css/jquery.dataTables.css" rel="stylesheet">
		<link type="text/css" rel="stylesheet" href="/fuxi/common/html/css/fuxi.min.css" />
		<script src="/basepack/modernizr/2.6/modernizr.js"></script>
		<!-- Respond.js - IE8 support of media queries -->
		<!--[if lt IE 9]>
		<script src="/fuxi/lib/respond/1.4/js/respond.min.js"></script>
		<![endif]-->

		<!-- load the dashboard css -->
		<link href="/fuxi/lib/sdashboard/sDashboard.css" rel="stylesheet">

		<!-- font awesome -->
		<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

		<!-- load gitter css -->
		<link href="/fuxi/lib/sdashboard/css/gitter/css/jquery.gritter.css" rel="stylesheet" />

		<!-- load jquery library -->
		<script src="/basepack/jquery/1.9/jquery.min.js"></script>

		<!-- load jquery ui library -->
		<script src="/fuxi/lib/jqueryui/1.10/jquery-ui-1.10.4.custom.min.js"></script>

		<!-- load touch punch library to enable dragging on touch based devices -->
		<script src="/fuxi/lib/sdashboard/libs/touchpunch/jquery.ui.touch-punch.js"></script>

		<!-- load gitter notification library -->
		<script src="/fuxi/lib/sdashboard/libs/gitter/jquery.gritter.js" type="text/javascript"></script>

		<!-- load datatables library -->
		<script src="/basepack/datatables-pt/1.9/js/jquery.dataTables.min.js"></script>
		<script src="/fuxi/lib/datatables-pt/1.9/js/inputPaging.min.js"></script>

		<!-- load flotr2 charting library -->
		<!--[if IE]>
		<script language="javascript" type="text/javascript" src="/fuxi/lib/sdashboard/libs/flotr2/flotr2.ie.min.js"></script>
		<![endif]-->
		<script src="/fuxi/lib/sdashboard/libs/flotr2/flotr2.js"></script>

		<!-- load dashboard library -->
		<script src="/fuxi/lib/sdashboard/jquery-sDashboard.js"></script>
		<!-- sample data external script file -->
		<script src="/fuxi/lib/sdashboard/libs/exampleData.js" type="text/javascript"></script>
		<!-- example code -->
		<script type="text/javascript">
			// list of dashboards - demo purpose
			var dBoardData = [];
			var randomString = "Lorem ipsum dolor sit amet,consectetur adipiscing elit. Aenean lacinia mollis condimentum. Proin vitae ligula quis ipsum elementum tristique. Vestibulum ut sem erat.";

			$(function() {
				// load data - demo purpose
				dBoardData.push({
					id : 1,
					//**********************************************//
					//dashboard json data
					//this is the data format that the dashboard framework expects
					//**********************************************//
					widgets : [{
						widgetTitle : "Bubble Chart Widget",
						widgetId : "id1",
						widgetType : "chart",
						enableRefresh : true,
						refreshCallBack : function(widgetId) {
							var refreshedData = {
								data : myExampleData.constructBubbleChartData(),
								options : myExampleData.bubbleChartOptions
							};
							return refreshedData;
						},
						widgetContent : {
							data : myExampleData.bubbleChartData,
							options : myExampleData.bubbleChartOptions
						}

					}, {
						widgetTitle : "Table Widget",
						widgetId : "id2",
						widgetType : "table",
						enableRefresh : true,
						refreshCallBack : function(widgetData) {
							return {
								"aaData" : [myExampleData.constructTableWidgetData(), myExampleData.constructTableWidgetData(), myExampleData.constructTableWidgetData(), myExampleData.constructTableWidgetData(), myExampleData.constructTableWidgetData(), myExampleData.constructTableWidgetData(), myExampleData.constructTableWidgetData()],

								"aoColumns" : [{
									"sTitle" : "Engine"
								}, {
									"sTitle" : "Browser"
								}, {
									"sTitle" : "Platform"
								}]
							};
						},
						widgetContent : myExampleData.tableWidgetData
					}, {
						widgetTitle : "Text Widget",
						widgetId : "id3",
						enableRefresh : true,
						refreshCallBack : function(widgetId) {
							return randomString + new Date();
						},
						widgetContent : randomString
					}, {
						widgetTitle : "Pie Chart Widget",
						widgetId : "id4",
						widgetType : "chart",
						widgetContent : {
							data : myExampleData.pieChartData,
							options : myExampleData.pieChartOptions
						}

					}, {
						widgetTitle : "bar Chart Widget",
						widgetId : "id5",
						widgetType : "chart",
						enableRefresh : true,
						refreshCallBack : function(widgetId) {
							var refreshedData = {
								data : myExampleData.constructBarChartData(),
								options : myExampleData.barChartOptions
							};
							return refreshedData;
						},
						widgetContent : {
							data : myExampleData.barChartData,
							options : myExampleData.barChartOptions
						}

					}, {
						widgetTitle : "line Chart Widget",
						widgetId : "id6",
						widgetType : "chart",
						getDataBySelection : true,
						widgetContent : {
							data : myExampleData.lineChartData,
							options : myExampleData.lineChartOptions
						}

					}, {
						widgetTitle : "Adding an existing dom element",
						widgetId : "id7",
						widgetContent : $("#myTweets").html()
					}]
				});
				
				

				// create nav
				loadNavs();

				// load first
				loadDBoard(0);

				//table row clicked event example
				$("#myDashboard").bind("sdashboardrowclicked", function(e, data) {
					$.gritter.add({
						position : 'bottom-left',
						title : 'Table row clicked',
						time : 1000,
						text : 'A table row within a table widget has been clicked, please check the console for additional event data'
					});

					if (console) {
						console.log("table row clicked, for widget: " + data.selectedWidgetId);
					}
				});

				//plot selected event example
				$("#myDashboard").bind("sdashboardplotselected", function(e, data) {
					$.gritter.add({
						position : 'bottom-left',
						title : 'Plot selected',
						time : 1000,
						text : 'A plot has been selected within a chart widget, please check the console for additional event data'
					});
					if (console) {
						console.log("chart range selected, for widget: " + data.selectedWidgetId);
					}
				});
				//plot click event example
				$("#myDashboard").bind("sdashboardplotclicked", function(e, data) {
					$.gritter.add({
						position : 'bottom-left',
						title : 'Plot Clicked',
						time : 1000,
						text : 'A plot has been clicked within a chart widget, please check the console for additional event data'
					});
					if (console) {
						console.log("chart clicked, for widget: " + data.selectedWidgetId);
					}
				});

				//widget order changes event example
				$("#myDashboard").bind("sdashboardorderchanged", function(e, data) {
					$.gritter.add({
						position : 'bottom-left',
						title : 'Order Changed',
						time : 4000,
						text : 'The widgets order has been changed,check the console for the sorted widget definitions array'
					});
					if (console) {
						console.log("Sorted Array");
						console.log("+++++++++++++++++++++++++");
						console.log(data.sortedDefinitions);
						console.log("+++++++++++++++++++++++++");
					}

				});

				//example for adding a text widget
				$("#btnAddWidget").click(function() {
					$("#myDashboard").sDashboard("addWidget", {
						widgetTitle : "Widget 7",
						widgetId : "id008",
						widgetContent : "Lorem ipsum dolor sit amet," + "consectetur adipiscing elit." + "Aenean lacinia mollis condimentum." + "Proin vitae ligula quis ipsum elementum tristique." + "Vestibulum ut sem erat."
					});
				});

				//example for adding a table widget
				$("#btnAddTableWidget").click(function() {
					$("#myDashboard").sDashboard("addWidget", {
						widgetTitle : "Table Widget 2",
						widgetId : "id007",
						widgetType : "table",
						widgetContent : myExampleData.tableWidgetData
					});

				});

				////example for  deleting a widget
				//$("#btnDeleteWidget").click(function () {
				//    $("#myDashboard").sDashboard("removeWidget", "id007");
				//});

				//example for adding a pie chart widget
				$("#btnAddPieChartWidget").click(function() {

					$("#myDashboard").sDashboard("addWidget", {
						widgetTitle : "Pie Chart 2",
						widgetId : "id006",
						widgetType : "chart",
						widgetContent : {
							data : myExampleData.pieChartData,
							options : myExampleData.pieChartOptions
						}
					});

				});

				//example for adding a bar chart widget
				$("#btnAddBarChartWidget").click(function() {

					$("#myDashboard").sDashboard("addWidget", {
						widgetTitle : "Bar Chart 2",
						widgetId : "id005",
						widgetType : "chart",
						enableRefresh : true,
						refreshCallBack : function(widgetId) {
							var refreshedData = {
								data : myExampleData.constructBarChartData(),
								options : myExampleData.barChartOptions
							};
							return refreshedData;
						},
						widgetContent : {
							data : myExampleData.barChartData,
							options : myExampleData.barChartOptions
						}
					});
				});

				//example for adding an line chart widget
				$("#btnAddLineChartWidget").click(function() {
					$("#myDashboard").sDashboard("addWidget", {
						widgetTitle : "Line Chart 2",
						widgetId : "id004",
						widgetType : "chart",
						getDataBySelection : true,
						widgetContent : {
							data : myExampleData.lineChartData,
							options : myExampleData.lineChartOptions
						}

					});
				});

				//example for adding an line chart widget
				$("#btnGetDBoardData").click(function() {
					var arr = getDBoardData();
					var d = '';
					$.each(arr, function(idx, elm) {
						d += elm.widgetTitle + ": " + JSON.stringify(elm) + '\n';
					});
					$("#divData").text(JSON.stringify(arr)).show();
				});

				$("#addBoard").click(function() {
					$('#modalAddBoard').modal('show');
					$('#txtDashboardTitle').val('');
				});

				 $('#modalAddBoard').on('shown.bs.modal', function() {
     				setTimeout(function(){
       				$('#txtDashboardTitle').focus();
     				}, 1);
  				 });

				 $("#addWidget").click(function() {
					$('#modalAddWidget').modal('show');
				});

				 $("#modalAddBoard").keyup(function(event){
   					 if(event.keyCode == 13){
        				$("#btAddDashboard").click();
    				}
				 });


			});

			function loadNavs() {
				// delete all
				$("#divDashboards").empty();

				$.each(dBoardData, function(idx, elem) {
				    $("#divDashboards").append('<li><a href="#" data-toggle="tab" onclick="loadDBoard(' + idx + ');"><span id="r' + idx + '">dashboard' + elem.id + '</span> <i class="glyphicon glyphicon-pencil pointer" onclick="editDBoard(event,' + idx + ');"></i> <i class="glyphicon glyphicon-remove pointer" onclick="removeDBoard(event,' + idx + ');"></i></a></li>');
				});

				$("#divDashboards li:first-child").addClass("active");
			}

			function loadDBoard(idx) {
			    //basic initialization example		                
				$("#myDashboard").empty().sDashboard({
				    dashboardData : dBoardData[idx].widgets
				});
			}

			function getID() {
				return Math.floor((Math.random() * 100000) + 1);
			}

			function newDBoard() {
				dBoardData.push({
					id : getID(),
					widgets : []
				});

				//loadNavs();
				var idx = dBoardCount();

				$("#divDashboards").append('<li><a href="#" data-toggle="tab" onclick="loadDBoard(' + idx + ');"><span id="r' + idx + '">' + $('#txtDashboardTitle').val() + '</span> <i class="glyphicon glyphicon-pencil pointer" onclick="editDBoard(event,' + idx + ');"></i> <i class="glyphicon glyphicon-remove pointer" onclick="removeDBoard(event, ' + idx + ');"></i></a></li>');

				$("#r"+idx).text($('#txtDashboardTitle').val());

				$("#divDashboards li").removeClass("active");
				$("#divDashboards li:last-child").addClass("active");

				$('#modalAddBoard').modal('hide')

				loadDBoard(idx);

				//$("#divFeatures").show();
			}

			function dBoardCount() {
				return dBoardData.length - 1;
			}

			function editDBoard(e, idx) {
			    e.stopPropagation();
			    alert("TODO");
			    //$("#addBoardModal").html("Alterar dashboard")
			    //$("#modalAddBoard").trigger('click');
			}

			function removeDBoard(e, idx) {
			    //var idx = dBoardCount();
			    e.stopPropagation();
                
			    // não deixar eliminar o último!
			    // TODO

				if (confirm('Delete Dashboard! Are you sure?')) {
					dBoardData.splice(idx, 1);
				    //loadNavs();
					loadDBoard(dBoardCount());
					$("#divDashboards li:eq("+idx+")").remove();
				}
				$("#divDashboards li:eq("+idx+")").addClass("active");
				console.log($("#divDashboards li:eq(" + idx + ")"));
			}

			//function toggleFeatures() {
				//$("#divFeatures").toggle();
			//}

			function getDBoardData() {
				return $("#myDashboard").sDashboard('getDashboardData');
			}
		</script>

		<style>
			.pointer {
				cursor: pointer;
			}
		</style>

	</head>
	<body>
		<div aria-hidden="false" aria-labelledby="addBoardModal" role="dialog" id="modalAddBoard" class="modal fade in">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button aria-hidden="true" data-dismiss="modal" class="close" type="button">
								×
							</button>
							<h4 id="addBoardModal" class="modal-title">Adicionar dashboard</h4>
							<p>
								Atribua um título ao dashboard que pretende criar 
							</p>
						</div>
						<div class="modal-body">
							<div class="form-horizontal">
								<div class="form-group">
									<label class="col-sm-2 control-label fx-required-field" for="txtDashboardTitle">Título</label>
									<div class="col-sm-10">
										<input type="text" id="txtDashboardTitle" class="form-control input-sm">
									</div>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button id="btAddDashboard" class="btn btn-primary btn-sm" type="button" onclick="newDBoard();">
								guardar
							</button>
							<button data-dismiss="modal" class="btn btn-default btn-sm" type="button">
								cancelar
							</button>

						</div>
					</div>
				</div>
			</div>

			<div aria-hidden="false" aria-labelledby="addWidgetModal" role="dialog" id="modalAddWidget" class="modal fade in">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button aria-hidden="true" data-dismiss="modal" class="close" type="button">
								×
							</button>
							<h4 id="addWidgetModal" class="modal-title">Adicionar widget</h4>
							<p>
								Defina a informação para o widget que pretende criar 
							</p>
						</div>
						<div class="modal-body">
							
										<button class="btn" id="btnAddWidget">
											Add Widget
										</button>
										<button class="btn" id="btnAddTableWidget">
											Add Table widget
										</button>
										<!--<button class="btn" id="btnDeleteWidget">
										3) Delete Table Widget
										</button>-->
										<button class="btn" id="btnAddPieChartWidget">
											Add Pie Chart widget
										</button>
										<button class="btn" id="btnAddBarChartWidget">
											Add Bar Chart widget
										</button>
										<button class="btn" id="btnAddLineChartWidget">
											Add Line Chart widget
										</button>

										<button class="btn" id="btnGetDBoardData">
											Get dashboard data (JSON)
										</button>

										<div id="divData" style="border:1px solid #CCC; display:none; width:100%; max-height:300px; overflow:auto"></div>
									
						</div>
						<div class="modal-footer">
							<button class="btn btn-primary btn-sm" type="button">
								guardar
							</button>
							<button data-dismiss="modal" class="btn btn-default btn-sm" type="button">
								cancelar
							</button>

						</div>
					</div>
				</div>
			</div>


		<div class="fx-push-footer fx-full-height">
			<header id="fx-header">
				<nav class="fx-navbar" role="navigation">
					<a class="fx-brand" href="#"><h1 class="fx-logo-brand">Fuxi</h1></a>
				</nav>
				<!-- breadcrumb -->
				<ul class="breadcrumb">
					<li>
						<a href="#"><i class="fuxicons fuxicons-home"></i>Início</a>
					</li>
					<li>
						<a href="#">Link</a>
					</li>
					<li class="active">
						Ativo
					</li>
				</ul>
			</header>

			<div class="fx-prevent-content-behind-footer fx-full-height">
				<div class="fx-main-content-wrapper">
					<div class="fx-entity-header fx-fixed-position" data-fix-to="top" data-calc-height="true">
						<div class="fx-entity-header-inner">
							<div class="fx-entity-header-headings clearfix">
								<div class="pull-left fx-constraint">

									<h1><span class="fx-info-icon"> <i class="fuxicons fuxicons-home"></i> </span> Início</h1>
								</div>
								<div class="pull-right">

									<a id="addBoard" href="#" class="btn btn-primary btn-sm">
										<i class="glyphicon glyphicon-plus"></i>
										adicionar dashboard
									</a>
								</div>
							</div>
						</div>
						<ul class="nav nav-tabs fx-main-tabs" id="divDashboards">
						</ul>
					</div>

					<div class="tab-content fx-main-tab-content">
						<div class="tab-pane active" id="tab-sobre">
							<div class="fx-tab-pane-inners">								
									
									<div style="padding: 20px; text-align: right">
										<button id="addWidget" class="btn btn-default btn-sm">
										<i class="glyphicon glyphicon-plus"></i>
										adicionar widget
										</button>

									</div>

									
								
							

								<ul id="myDashboard"></ul>

								<div id="myTweets" style="display:none">
									<h1>I was already on this page, but re-rendered as a widget</h1>
								</div>
							</div>
						</div>

					</div>

				</div>

			</div>

			<!-- FOOTER ABOUT -->
			<!--# include file="/fuxi/partials/html/partial-footer-about.html" -->
		</div>

		<script src="/basepack/bootstrap-pt/3.0/js/bootstrap.min.js"></script>
		<script src="/fuxi/common/exec/fuxi.min.js"></script>
		<script>
			$(function() {
				FUXI.ExpandableForm.init();
				FUXI.FixedPositions.init();
			});
		</script>
	</body>
</html>